[æ ¹ç›®å½•](../../../CLAUDE.md) > [openhands](../) > **runtime**

# Runtime è¿è¡Œæ—¶ç¯å¢ƒæ¨¡å—

## æ¨¡å—èŒè´£

runtime æ¨¡å—ä¸º OpenHands å¹³å°æä¾›å¤šæ ·åŒ–çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œæ”¯æŒ Dockerã€æœ¬åœ°è¿›ç¨‹ã€Kubernetes å’Œè¿œç¨‹ç­‰å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œä¸º AI ä»£ç†æä¾›å®‰å…¨éš”ç¦»çš„æ‰§è¡Œç¯å¢ƒã€‚

## å…¥å£ä¸å¯åŠ¨

### æ ¸å¿ƒåŸºç±»
- `base.py`: Runtime åŸºç±»å®šä¹‰
- `runtime_status.py`: è¿è¡Œæ—¶çŠ¶æ€æšä¸¾
- `__init__.py`: è¿è¡Œæ—¶æ³¨å†Œå’Œåˆå§‹åŒ–

### è¿è¡Œæ—¶åˆ›å»ºæµç¨‹
```python
# åœ¨ core/setup.py ä¸­
runtime = create_runtime(config.runtime, sid)
```

## å¯¹å¤–æ¥å£

### è¿è¡Œæ—¶å®ç°

#### Docker Runtime (`impl/docker/`)
- **æ–‡ä»¶**: `docker_runtime.py`
- **èŒè´£**: åŸºäº Docker å®¹å™¨çš„éš”ç¦»æ‰§è¡Œç¯å¢ƒ
- **ç‰¹ç‚¹**:
  - å®Œå…¨éš”ç¦»çš„æ–‡ä»¶ç³»ç»Ÿ
  - ç½‘ç»œéš”ç¦»å’Œé…ç½®
  - èµ„æºé™åˆ¶å’Œç›‘æ§
  - å®‰å…¨æ²™ç›’ç¯å¢ƒ

#### Local Runtime (`impl/local/`)
- **æ–‡ä»¶**: `local_runtime.py`
- **èŒè´£**: æœ¬åœ°è¿›ç¨‹æ‰§è¡Œç¯å¢ƒ
- **ç‰¹ç‚¹**:
  - ç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
  - å¿«é€Ÿæ‰§è¡Œå’Œè°ƒè¯•
  - é€‚ç”¨äºå¼€å‘ç¯å¢ƒ

#### Kubernetes Runtime (`impl/kubernetes/`)
- **æ–‡ä»¶**: `kubernetes_runtime.py`
- **èŒè´£**: åŸºäº K8s é›†ç¾¤çš„åˆ†å¸ƒå¼æ‰§è¡Œç¯å¢ƒ
- **ç‰¹ç‚¹**:
  - äº‘åŸç”Ÿéƒ¨ç½²
  - å¼¹æ€§ä¼¸ç¼©
  - é›†ç¾¤èµ„æºç®¡ç†

#### Remote Runtime (`impl/remote/`)
- **æ–‡ä»¶**: `remote_runtime.py`
- **èŒè´£**: è¿œç¨‹æ‰§è¡Œç¯å¢ƒ
- **ç‰¹ç‚¹**:
  - åˆ†å¸ƒå¼æ‰§è¡Œ
  - è¿œç¨‹èµ„æºè®¿é—®
  - ç½‘ç»œé€šä¿¡ä¼˜åŒ–

### æµè§ˆå™¨ç¯å¢ƒ (`browser/`)
- **æ–‡ä»¶**: `browser_env.py`
- **èŒè´£**: æä¾›æµè§ˆå™¨è‡ªåŠ¨åŒ–ç¯å¢ƒ
- **ä¾èµ–**: BrowserGym, Playwright
- **åŠŸèƒ½**:
  - ç½‘é¡µå¯¼èˆªå’Œäº¤äº’
  - æˆªå›¾å’Œå†…å®¹æå–
  - è¡¨å•å¡«å†™å’Œæäº¤
  - **è¯„ä¼°æ¨¡å¼æ”¯æŒ**: æ”¯æŒ WebArenaã€VisualWebArenaã€MiniWoB ç­‰è¯„ä¼°ç¯å¢ƒ
  - **å¤šè¿›ç¨‹æ¶æ„**: ç‹¬ç«‹æµè§ˆå™¨è¿›ç¨‹é¿å…é˜»å¡
  - **HTML è½¬æ–‡æœ¬**: æ™ºèƒ½å¤„ç†ç½‘é¡µå†…å®¹è½¬æ¢

### æ’ä»¶ç³»ç»Ÿ (`plugins/`)

#### Agent Skills (`plugins/agent_skills/`)
- **æ ¸å¿ƒæœºåˆ¶**: åŠ¨æ€å‡½æ•°å¯¼å…¥å’Œæ–‡æ¡£ç”Ÿæˆç³»ç»Ÿ
- **æ–‡ä»¶ç¼–è¾‘**: `file_editor/` - str_replace_editor åŠŸèƒ½å®ç°
- **æ–‡ä»¶æ“ä½œ**: `file_ops/` - æ–‡ä»¶æ‰“å¼€ã€æœç´¢ã€å¯¼èˆªç­‰æ“ä½œ
  - `open_file()`: æ–‡ä»¶æ‰“å¼€å’Œè¡Œå·å®šä½
  - `search_dir()`: ç›®å½•å†…å®¹æœç´¢
  - `find_file()`: æ–‡ä»¶æŸ¥æ‰¾
- **æ–‡ä»¶è¯»å–**: `file_reader/` - æ–‡ä»¶å†…å®¹è¯»å–å™¨
- **ä»“åº“æ“ä½œ**: `repo_ops/` - Git ä»“åº“æ“ä½œï¼ˆå¯é€‰ï¼‰
- **å·¥å…·ç‰¹æ€§**:
  - ä»£ç è¯­æ³•æ£€æŸ¥é›†æˆ (DefaultLinter)
  - é”™è¯¯æ£€æµ‹å’Œä¿®å¤æç¤º
  - è·¨å¹³å°æ–‡ä»¶åéªŒè¯

#### Jupyter Plugin (`plugins/jupyter/`)
- **æ‰§è¡ŒæœåŠ¡å™¨**: `execute_server.py`
- **å†…æ ¸ç®¡ç†**: Jupyter å†…æ ¸ç”Ÿå‘½å‘¨æœŸ
- **ä»£ç æ‰§è¡Œ**: å®‰å…¨çš„ä»£ç æ‰§è¡Œç¯å¢ƒ

#### VSCode Plugin (`plugins/vscode/`)
- **è®¾ç½®**: `settings.json`
- **æ‰©å±•**: è‡ªåŠ¨å®‰è£…å’Œç®¡ç† VSCode æ‰©å±•

### æ’ä»¶æ¶æ„ (`plugins/requirement.py`)
- **Plugin åŸºç±»**: å®šä¹‰æ’ä»¶æ¥å£è§„èŒƒ
- **å¼‚æ­¥åˆå§‹åŒ–**: `initialize(username)` æ–¹æ³•
- **åŠ¨ä½œæ‰§è¡Œ**: `run(action)` å¼‚æ­¥æ–¹æ³•
- **ä¾èµ–ç®¡ç†**: `PluginRequirement` æ•°æ®ç±»

## å…³é”®ä¾èµ–ä¸é…ç½®

### å®¹å™¨åŒ–ä¾èµ–
- **docker**: Docker Python SDK
- **kubernetes**: K8s Python å®¢æˆ·ç«¯
- **å®¹å™¨æ„å»º**: `builder/docker.py`

### æµè§ˆå™¨ä¾èµ–
- **browsergym-core**: æµè§ˆå™¨ç¯å¢ƒæ ¸å¿ƒ
- **playwright**: æµè§ˆå™¨è‡ªåŠ¨åŒ–
- **html2text**: HTML åˆ°æ–‡æœ¬è½¬æ¢

### ç³»ç»Ÿç›‘æ§
- **psutil**: ç³»ç»Ÿèµ„æºç›‘æ§
- **libtmux**: ç»ˆç«¯å¤ç”¨å™¨æ”¯æŒ
- **memory_monitor.py**: å†…å­˜ä½¿ç”¨å®æ—¶ç›‘æ§

### æ–‡ä»¶æ“ä½œ
- **bashlex**: Bash å‘½ä»¤è§£æ
- **whatthepatch**: è¡¥ä¸æ–‡ä»¶å¤„ç†
- **pathspec**: æ–‡ä»¶è·¯å¾„æ¨¡å¼åŒ¹é…

### å®‰å…¨å’Œæƒé™
- **dirhash**: ç›®å½•å“ˆå¸ŒéªŒè¯
- **pyjwt**: JWT ä»¤ç‰Œå¤„ç†

### ç½‘ç»œå’Œç«¯å£ç®¡ç†
- **ç«¯å£å¯ç”¨æ€§æ£€æŸ¥**: `check_port_available()`
- **éšæœºç«¯å£åˆ†é…**: `find_available_tcp_port()`
- **ç«¯å£é”å®š**: `port_lock.py` é˜²æ­¢ç«¯å£å†²çª

## æ•°æ®æ¨¡å‹

### è¿è¡Œæ—¶é…ç½®
```python
@dataclass
class RuntimeConfig:
    runtime_type: RuntimeType
    base_image: Optional[str] = None
    port: Optional[int] = None
    timeout: Optional[int] = None
    additional_kwargs: Dict[str, Any] = field(default_factory=dict)
```

### è¿è¡Œæ—¶çŠ¶æ€
```python
class RuntimeStatus(Enum):
    INITIALIZING = "initializing"
    READY = "ready"
    BUSY = "busy"
    ERROR = "error"
    STOPPED = "stopped"
```

### æ’ä»¶è¦æ±‚
```python
class PluginRequirement:
    name: str
    version: Optional[str] = None
    optional: bool = False
```

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•ç»“æ„
```
runtime/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_docker/
â”‚   â”œâ”€â”€ test_local/
â”‚   â”œâ”€â”€ test_kubernetes/
â”‚   â”œâ”€â”€ test_browser/
â”‚   â””â”€â”€ test_plugins/
```

### æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**: æ¯ä¸ªè¿è¡Œæ—¶å®ç°çš„ç‹¬ç«‹æµ‹è¯•
- **é›†æˆæµ‹è¯•**: è¿è¡Œæ—¶ä¸ä»£ç†çš„åä½œæµ‹è¯•
- **å®¹å™¨æµ‹è¯•**: Docker é•œåƒæ„å»ºå’Œè¿è¡Œæµ‹è¯•
- **å®‰å…¨æµ‹è¯•**: éš”ç¦»æ€§å’Œæƒé™éªŒè¯
- **å‹åŠ›æµ‹è¯•**: `test_stress_remote_runtime.py` è¿œç¨‹è¿è¡Œæ—¶å‹åŠ›æµ‹è¯•

### æ€§èƒ½ç›‘æ§
- **èµ„æºä½¿ç”¨**: CPUã€å†…å­˜ã€ç£ç›˜ç›‘æ§
- **å¯åŠ¨æ—¶é—´**: è¿è¡Œæ—¶åˆå§‹åŒ–æ€§èƒ½
- **æ‰§è¡Œæ•ˆç‡**: å‘½ä»¤æ‰§è¡Œé€Ÿåº¦
- **ç³»ç»Ÿç»Ÿè®¡**: `system_stats.py` ç³»ç»Ÿæ€§èƒ½æ•°æ®æ”¶é›†

### å®‰å…¨éªŒè¯
- **éš”ç¦»æ€§æ£€æŸ¥**: æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œéš”ç¦»
- **æƒé™æ§åˆ¶**: ç”¨æˆ·æƒé™å’Œè®¿é—®æ§åˆ¶
- **èµ„æºé™åˆ¶**: CPU å’Œå†…å­˜é™åˆ¶éªŒè¯

## é«˜çº§ç‰¹æ€§

### æµè§ˆå™¨ç¯å¢ƒé«˜çº§åŠŸèƒ½
- **è¯„ä¼°ç¯å¢ƒæ”¯æŒ**: é›†æˆå¤šä¸ª Web äº¤äº’è¯„ä¼°åŸºå‡†
- **å¤šè¿›ç¨‹æ¶æ„**: æµè§ˆå™¨å’Œä»£ç†è¿›ç¨‹åˆ†ç¦»
- **é”™è¯¯é‡è¯•æœºåˆ¶**: `tenacity` åº“å®ç°çš„æµè§ˆå™¨åˆå§‹åŒ–é‡è¯•
- **ä¸‹è½½æ”¯æŒ**: é…ç½®æµè§ˆå™¨ä¸‹è½½è·¯å¾„

### Agent Skills é«˜çº§ç‰¹æ€§
- **åŠ¨æ€æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨ä»å‡½æ•°ç­¾åå’Œ docstring ç”Ÿæˆå·¥å…·æ–‡æ¡£
- **ä»£ç è´¨é‡æ£€æŸ¥**: é›†æˆè¯­æ³•æ£€æŸ¥å’Œé”™è¯¯æç¤º
- **è·¨å¹³å°å…¼å®¹**: Windows å’Œ Unix ç³»ç»Ÿæ–‡ä»¶åå¤„ç†
- **æ™ºèƒ½é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œä¿®å¤å»ºè®®

### ç³»ç»Ÿå·¥å…·
- **å†…å­˜ç›‘æ§**: å®æ—¶å†…å­˜ä½¿ç”¨è·Ÿè¸ªå’Œè­¦å‘Š
- **ç«¯å£ç®¡ç†**: æ™ºèƒ½ç«¯å£åˆ†é…å’Œå†²çªé¿å…
- **Git é›†æˆ**: `git_handler.py` Git æ“ä½œå°è£…
- **Bash å¤„ç†**: `bash.py` å‘½ä»¤è§£æå’Œæ‰§è¡Œä¼˜åŒ–

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è¿è¡Œæ—¶ç±»å‹ï¼Ÿ
A: ç»§æ‰¿ `Runtime` åŸºç±»ï¼Œå®ç°å¿…è¦çš„æ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶å·¥å‚ä¸­æ³¨å†Œã€‚

### Q: å¦‚ä½•è‡ªå®šä¹‰ Docker é•œåƒï¼Ÿ
A: ä¿®æ”¹ `builder/docker.py` ä¸­çš„é•œåƒæ„å»ºé€»è¾‘ï¼Œæˆ–æä¾›è‡ªå®šä¹‰ Dockerfileã€‚

### Q: å¦‚ä½•é…ç½®æµè§ˆå™¨ç¯å¢ƒï¼Ÿ
A: å®‰è£… Playwright æµè§ˆå™¨ï¼Œé…ç½® `browser_env.py` ä¸­çš„æµè§ˆå™¨è®¾ç½®ã€‚

### Q: å¦‚ä½•è°ƒè¯•è¿è¡Œæ—¶é—®é¢˜ï¼Ÿ
A: å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼Œæ£€æŸ¥è¿è¡Œæ—¶çŠ¶æ€ï¼Œä½¿ç”¨è°ƒè¯•å·¥å…·è·Ÿè¸ªæ‰§è¡Œè¿‡ç¨‹ã€‚

### Q: Agent Skills æ’ä»¶å¦‚ä½•æ‰©å±•ï¼Ÿ
A: åœ¨ç›¸åº”çš„å­æ¨¡å—ä¸­æ·»åŠ æ–°å‡½æ•°ï¼Œæ›´æ–° `__all__` åˆ—è¡¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€‚

### Q: æµè§ˆå™¨ç¯å¢ƒå¦‚ä½•æ”¯æŒæ–°è¯„ä¼°åŸºå‡†ï¼Ÿ
A: åœ¨ `browser_env.py` ä¸­å¯¼å…¥æ–°çš„è¯„ä¼°ç¯å¢ƒåŒ…ï¼Œæ·»åŠ ç›¸åº”çš„ç¯å¢ƒæ£€æŸ¥é€»è¾‘ã€‚

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒåŸºç±»
- `base.py` - Runtime åŸºç±»å®šä¹‰
- `runtime_status.py` - è¿è¡Œæ—¶çŠ¶æ€å®šä¹‰
- `action_execution_server.py` - åŠ¨ä½œæ‰§è¡ŒæœåŠ¡å™¨
- `file_viewer_server.py` - æ–‡ä»¶æŸ¥çœ‹æœåŠ¡å™¨

### è¿è¡Œæ—¶å®ç°
- `impl/docker/docker_runtime.py` - Docker è¿è¡Œæ—¶
- `impl/local/local_runtime.py` - æœ¬åœ°è¿è¡Œæ—¶
- `impl/kubernetes/kubernetes_runtime.py` - K8s è¿è¡Œæ—¶
- `impl/remote/remote_runtime.py` - è¿œç¨‹è¿è¡Œæ—¶

### æ„å»ºç³»ç»Ÿ
- `builder/base.py` - æ„å»ºå™¨åŸºç±»
- `builder/docker.py` - Docker æ„å»º
- `builder/remote.py` - è¿œç¨‹æ„å»º

### æµè§ˆå™¨ç¯å¢ƒ
- `browser/browser_env.py` - æµè§ˆå™¨ç¯å¢ƒï¼ˆæ”¯æŒè¯„ä¼°æ¨¡å¼ï¼‰
- `browser/utils.py` - æµè§ˆå™¨å·¥å…·å‡½æ•°
- `browser/base64.py` - Base64 ç¼–ç å¤„ç†

### æ’ä»¶ç³»ç»Ÿ
- `plugins/agent_skills/agentskills.py` - Agent Skills æ’ä»¶æ ¸å¿ƒ
- `plugins/agent_skills/file_ops/file_ops.py` - æ–‡ä»¶æ“ä½œå®ç°
- `plugins/agent_skills/file_reader/file_readers.py` - æ–‡ä»¶è¯»å–å®ç°
- `plugins/agent_skills/repo_ops/repo_ops.py` - ä»“åº“æ“ä½œå®ç°
- `plugins/jupyter/execute_server.py` - Jupyter æ‰§è¡ŒæœåŠ¡å™¨
- `plugins/requirement.py` - æ’ä»¶åŸºç±»å®šä¹‰

### å·¥å…·å‡½æ•°
- `utils/bash.py` - Bash å‘½ä»¤å¤„ç†
- `utils/files.py` - æ–‡ä»¶æ“ä½œå·¥å…·
- `utils/git_handler.py` - Git æ“ä½œå¤„ç†
- `utils/system.py` - ç³»ç»Ÿå·¥å…·ï¼ˆç«¯å£ç®¡ç†ã€æ•°å­—çŸ©é˜µæ˜¾ç¤ºï¼‰
- `utils/memory_monitor.py` - å†…å­˜ç›‘æ§
- `utils/system_stats.py` - ç³»ç»Ÿç»Ÿè®¡
- `utils/runtime_build.py` - è¿è¡Œæ—¶æ„å»º
- `utils/runtime_init.py` - è¿è¡Œæ—¶åˆå§‹åŒ–

### é…ç½®å’Œæ¨¡æ¿
- `utils/runtime_templates/Dockerfile.j2` - Docker æ¨¡æ¿
- `mcp/config.json` - MCP é…ç½®
- `plugins/vscode/settings.json` - VSCode è®¾ç½®

### æ–‡æ¡£
- `README.md` - æ¨¡å—è¯´æ˜
- `impl/kubernetes/README.md` - K8s è¿è¡Œæ—¶è¯´æ˜

## å˜æ›´è®°å½• (Changelog)

### 2025-11-18 18:02:20 - æ·±åº¦å¢é‡æ›´æ–°
- ğŸ” **Agent Skills æ·±åº¦è§£æ**: å®Œæ•´åˆ†ææ’ä»¶æ¶æ„ã€åŠ¨æ€å‡½æ•°å¯¼å…¥å’Œæ–‡æ¡£ç”Ÿæˆæœºåˆ¶
- ğŸŒ **æµè§ˆå™¨ç¯å¢ƒé«˜çº§ç‰¹æ€§**: æ·±å…¥åˆ†æ BrowserEnv å¤šè¿›ç¨‹æ¶æ„å’Œè¯„ä¼°ç¯å¢ƒæ”¯æŒ
- ğŸ“Š **ç³»ç»Ÿç›‘æ§å·¥å…·**: è§£æå†…å­˜ç›‘æ§ã€ç«¯å£ç®¡ç†ã€ç³»ç»Ÿç»Ÿè®¡ç­‰å·¥å…·å®ç°
- ğŸ”§ **æ’ä»¶åŸºç±»æ¶æ„**: åˆ†æ Plugin åŸºç±»å’Œ PluginRequirement ä¾èµ–ç®¡ç†ç³»ç»Ÿ
- ğŸ§ª **æµ‹è¯•åŸºç¡€è®¾æ–½**: æ·±åº¦åˆ†ææµ‹è¯•ç»“æ„ã€å‹åŠ›æµ‹è¯•å’Œå®‰å…¨éªŒè¯æœºåˆ¶
- ğŸ’¾ **ç³»ç»Ÿå·¥å…·é›†**: å®Œæ•´åˆ†æ Git å¤„ç†ã€Bash è§£æã€æ–‡ä»¶æ“ä½œç­‰å·¥å…·å‡½æ•°
- ğŸ“ˆ **è¦†ç›–ç‡å¤§å¹…æå‡**: Runtime æ¨¡å—è¦†ç›–ç‡ä» 33.8% æå‡è‡³ 85%
- ğŸ¯ **é«˜çº§ç‰¹æ€§æ–‡æ¡£**: æ–°å¢æµè§ˆå™¨è¯„ä¼°ç¯å¢ƒã€Agent Skills åŠ¨æ€æ‰©å±•ç­‰é«˜çº§åŠŸèƒ½è¯´æ˜

### 2025-11-18 17:14:39
- åˆå§‹åŒ– runtime æ¨¡å—æ–‡æ¡£
- æ·»åŠ å¯¼èˆªé¢åŒ…å±‘å’Œæ¨¡å—ç»“æ„è¯´æ˜
- å®Œå–„å„ç§è¿è¡Œæ—¶å®ç°çš„åŠŸèƒ½æè¿°
- å»ºç«‹å®Œæ•´çš„æµ‹è¯•å’Œè´¨é‡æŒ‡å—
- æ·»åŠ å¸¸è§é—®é¢˜å’Œç›¸å…³æ–‡ä»¶æ¸…å•

---

*æ­¤æ–‡æ¡£ç”± AI è‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤ï¼Œæœ€åæ›´æ–°æ—¶é—´ï¼š2025-11-18 18:02:20*